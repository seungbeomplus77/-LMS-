<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sp.app.mapper.EnterGuideMapper">
	  <!-- 입학안내 글 등록 -->
  <insert id="insertEnterGuide" parameterType="com.sp.app.model.EnterGuide">
    INSERT INTO enterGuide 
      (enterGuideNum, subject, content, hitCount, saveFilename, originalFilename, reg_date, modify_date, showEnterGuide, schoolId, categoryId)
    VALUES 
      (enterGuide_seq.nextval, #{subject}, #{content}, #{hitCount}, #{saveFilename}, #{originalFilename}, SYSDATE, SYSDATE, #{showEnterGuide}, #{schoolId}, #{categoryId})
  </insert>
  
  <!-- 입학안내 글 수정 -->
  <update id="updateEnterGuide" parameterType="com.sp.app.model.EnterGuide">
    UPDATE enterGuide
    SET subject = #{subject},
        content = #{content},
        hitCount = #{hitCount},
        saveFilename = #{saveFilename},
        originalFilename = #{originalFilename},
        modify_date = SYSDATE,
        showEnterGuide = #{showEnterGuide},
        categoryId = #{categoryId}
    WHERE enterGuideNum = #{enterGuideNum}
  </update>
  
  <!-- 입학안내 글 삭제 -->
  <delete id="deleteEnterGuide" parameterType="long">
    DELETE FROM enterGuide
    WHERE enterGuideNum = #{enterGuideNum}
  </delete>
  
  <!-- 단건 조회 (PK: enterGuideNum) -->
  <select id="findEnterGuideById" parameterType="long" resultType="com.sp.app.model.EnterGuide">
    SELECT enterGuideNum, subject, content, hitCount, saveFilename, originalFilename,
           TO_CHAR(reg_date, 'YYYY-MM-DD') AS reg_date,
           TO_CHAR(modify_date, 'YYYY-MM-DD') AS modify_date,
           showEnterGuide, schoolId, categoryId
    FROM enterGuide
    WHERE enterGuideNum = #{enterGuideNum}
  </select>
  
  <!-- 조건에 따른 입학안내 글 목록 조회 -->
  <select id="listEnterGuide" parameterType="map" resultType="com.sp.app.model.EnterGuide">
    SELECT enterGuideNum, subject, content, hitCount, saveFilename, originalFilename,
           TO_CHAR(reg_date, 'YYYY-MM-DD') AS reg_date,
           TO_CHAR(modify_date, 'YYYY-MM-DD') AS modify_date,
           showEnterGuide, schoolId, categoryId
    FROM enterGuide
    <where>
      <if test="keyword != null and keyword != ''">
        AND (subject LIKE '%' || #{keyword} || '%' OR content LIKE '%' || #{keyword} || '%')
      </if>
    </where>
    ORDER BY enterGuideNum DESC
  </select>
  
  <!-- 데이터 건수 조회 (페이징 등) -->
  <select id="dataCount" parameterType="map" resultType="int">
    SELECT COUNT(*)
    FROM enterGuide
    <where>
      <if test="keyword != null and keyword != ''">
        AND (subject LIKE '%' || #{keyword} || '%' OR content LIKE '%' || #{keyword} || '%')
      </if>
    </where>
  </select>
  
  <!-- 조회수 업데이트 -->
  <update id="updateHitCount" parameterType="long">
    UPDATE enterGuide
    SET hitCount = hitCount + 1
    WHERE enterGuideNum = #{enterGuideNum}
  </update>
  
  <!-- 이전 글 조회 -->
  <select id="findByPrev" parameterType="map" resultType="com.sp.app.model.EnterGuide">
    SELECT *
    FROM (
      SELECT enterGuideNum, subject, content, hitCount, saveFilename, originalFilename,
             TO_CHAR(reg_date, 'YYYY-MM-DD') AS reg_date,
             TO_CHAR(modify_date, 'YYYY-MM-DD') AS modify_date,
             showEnterGuide, schoolId, categoryId
      FROM enterGuide
      <where>
         <if test="enterGuideNum != null">
           AND enterGuideNum &lt; #{enterGuideNum}
         </if>
         <if test="keyword != null and keyword != ''">
           AND (subject LIKE '%' || #{keyword} || '%' OR content LIKE '%' || #{keyword} || '%')
         </if>
      </where>
      ORDER BY enterGuideNum DESC
    )
    WHERE ROWNUM = 1
  </select>
  
  <!-- 다음 글 조회 -->
  <select id="findByNext" parameterType="map" resultType="com.sp.app.model.EnterGuide">
    SELECT *
    FROM (
      SELECT enterGuideNum, subject, content, hitCount, saveFilename, originalFilename,
             TO_CHAR(reg_date, 'YYYY-MM-DD') AS reg_date,
             TO_CHAR(modify_date, 'YYYY-MM-DD') AS modify_date,
             showEnterGuide, schoolId, categoryId
      FROM enterGuide
      <where>
         <if test="enterGuideNum != null">
           AND enterGuideNum &gt; #{enterGuideNum}
         </if>
         <if test="keyword != null and keyword != ''">
           AND (subject LIKE '%' || #{keyword} || '%' OR content LIKE '%' || #{keyword} || '%')
         </if>
      </where>
      ORDER BY enterGuideNum ASC
    )
    WHERE ROWNUM = 1
  </select>
</mapper>